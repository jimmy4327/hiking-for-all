<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hiking For All</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2SlyN4aVSzjEVtMphTbzYrTRQOiiAlBz1Bq+d9k=" crossorigin=""/>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #e0f2f1;
      color: #004d40;
    }

    header {
      background: #00796b;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
    }

    .container {
      max-width: 800px;
      margin: 1rem auto;
      padding: 1rem;
    }

    input[type="text"] {
      width: 70%;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: #004d40;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #00332e;
    }

    #map {
      height: 400px;
      width: 100%;
      margin-top: 1rem;
      border-radius: 10px;
    }

    .trail-list {
      margin-top: 1rem;
    }

    .trail {
      background: #ffffffcc;
      margin: 0.5rem 0;
      padding: 0.8rem;
      border-left: 4px solid #00796b;
      border-radius: 4px;
    }

    @media (max-width: 600px) {
      input[type="text"] {
        width: 100%;
        margin-bottom: 0.5rem;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>Hiking For All</header>
  <div class="container">
    <p>Enter a location to find nearby hiking trails:</p>
    <input type="text" id="locationInput" placeholder="e.g. Denver, CO" />
    <button onclick="findTrails()">Search</button>

    <div id="map"></div>
    <div class="trail-list" id="results"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j8RE8TTVFMBc9H3vuFwFa5GgRF09z8eY9i1Gz8M=" crossorigin=""></script>
  <script>
    let map = L.map('map').setView([39.5, -98.35], 4); // USA center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);
    let trailLayer = L.layerGroup().addTo(map);

    async function findTrails() {
      const loc = document.getElementById('locationInput').value;
      const results = document.getElementById('results');
      trailLayer.clearLayers();
      results.innerHTML = 'Loading…';

      try {
        const geo = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(loc)}&format=json`);
        const geoData = await geo.json();
        if (!geoData.length) {
          results.innerHTML = '<p>Location not found.</p>';
          return;
        }

        const { lat, lon } = geoData[0];
        map.setView([lat, lon], 13);

        const overpass = `
          [out:json][timeout:25];
          (
            way["highway"~"path|footway"](around:10000,${lat},${lon});
          );
          (._;>;);
          out body;
        `;
        const response = await fetch('https://overpass-api.de/api/interpreter', {
          method: 'POST',
          body: overpass,
          headers: { 'Content-Type': 'text/plain' }
        });
        const data = await response.json();

        const nodes = {};
        data.elements.filter(el => el.type === "node").forEach(n => {
          nodes[n.id] = [n.lat, n.lon];
        });

        results.innerHTML = '';

        const ways = data.elements.filter(el => el.type === "way");
        ways.forEach(way => {
          const name = way.tags?.name || "Unnamed Trail";
          const difficulty = way.tags?.sac_scale || "unknown";
          const note = way.tags?.note || "";

          // Trail info
          const div = document.createElement("div");
          div.className = "trail";
          div.innerHTML = `<strong>${name}</strong><br><em>Difficulty:</em> ${difficulty}<br>${note}`;
          results.appendChild(div);

          // Polyline
          const latlngs = way.nodes.map(nodeId => nodes[nodeId]).filter(Boolean);
          if (latlngs.length >= 2) {
            const line = L.polyline(latlngs, {
              color: '#00796b',
              weight: 3
            }).bindPopup(`<strong>${name}</strong><br>Difficulty: ${difficulty}`);
            trailLayer.addLayer(line);
          }
        });

        if (ways.length === 0) {
          results.innerHTML = "<p>No trails found nearby.</p>";
        }
      } catch (err) {
        console.error(err);
        results.innerHTML = '<p>Error fetching trails. Try again.</p>';
      }
    }
  </script>
</body>
</html>
